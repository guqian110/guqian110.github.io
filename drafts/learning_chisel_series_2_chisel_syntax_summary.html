
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../theme/pygments/monokai.min.css">

    <script src="../theme/tipuesearch/jquery.min.js"></script>
    <script src="../theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="../theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="../theme/tipuesearch/tipuesearch_set.min.js"></script>
    <script src="../tipuesearch_content.js"></script>
    <link rel="stylesheet" href="../theme/tipuesearch/tipuesearch.min.css" />

  <link rel="stylesheet" type="text/css" href="../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../theme/font-awesome/css/solid.css">


    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Qian's Blog Atom">


    <link rel="shortcut icon" href="/images/favicon_64x64.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon_64x64.ico" type="image/x-icon">

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48826831-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Qian Gu" />
<meta name="description" content="chisel_tutorial 和 chisel3 的 wiki学习笔记" />
<meta name="keywords" content="chisel">


<meta property="og:site_name" content="Qian's Blog"/>
<meta property="og:title" content="学习 chisel 系列 #2： Chisel Syntax Summary"/>
<meta property="og:description" content="chisel_tutorial 和 chisel3 的 wiki学习笔记"/>
<meta property="og:locale" content="en"/>
<meta property="og:url" content="../drafts/learning_chisel_series_2_chisel_syntax_summary.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-05-10 14:56:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../author/qian-gu.html">
<meta property="article:section" content="IC"/>
<meta property="article:tag" content="chisel"/>
<meta property="og:image" content="/images/logo.png">

  <title>Qian's Blog &ndash; 学习 chisel 系列 #2： Chisel Syntax Summary</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-1821536199377100",
      enable_page_level_ads: true
    });
  </script>
</head>
<body >
  <aside>
    <div>
      <a href="..">
        <img src="/images/logo.png" alt="Qian Gu" title="Qian Gu">
      </a>

      <h1>
        <a href="..">Qian Gu</a>
      </h1>

<p>Read >> Think >> Write</p>
        <form class="navbar-search" action="/search.html" role="search">
          <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
        </form>

      <nav>
        <ul class="list">


              <li>
                <a target="_blank"
                   href="../pages/about-me.html#about-me">
                  About Me
                </a>
              </li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-envelope" href="mailto:guqian110@163.com" target="_blank">
              <i class="fas fa-envelope"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/guqian110" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/qian_gu" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="..">Home</a>

      <a href="/authors.html">Authors</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="learning_chisel_series_2_chisel_syntax_summary">学习 chisel 系列 #2： Chisel Syntax Summary</h1>
    <p>
      Posted on 2020-05-10 14:56 in <a href="../category/ic.html">IC</a>

    </p>
  </header>


  <div class="col-lg-3 hidden-xs hidden-sm">
        <div id="toc"><ul><li><a class="toc-href" href="#" title="学习 chisel 系列 #2： Chisel Syntax Summary">学习 chisel 系列 #2： Chisel Syntax Summary</a><ul><li><a class="toc-href" href="#chisel tutorial &amp; chisel3" title="Chisel Tutorial &amp; Chisel3">Chisel Tutorial &amp; Chisel3</a></li><li><a class="toc-href" href="#bian liang" title="变量">变量</a><ul><li><a class="toc-href" href="#wire" title="wire">wire</a></li></ul></li><li><a class="toc-href" href="#kong zhi yu ju_1" title="控制语句">控制语句</a><ul><li><a class="toc-href" href="#for loop" title="for loop">for loop</a></li><li><a class="toc-href" href="#if-elseif-if" title="if-elseif-if">if-elseif-if</a></li><li><a class="toc-href" href="#when" title="when">when</a></li><li><a class="toc-href" href="#assignments and re-assignments" title="Assignments and Re-assignments">Assignments and Re-assignments</a></li><li><a class="toc-href" href="#bit extraction" title="Bit Extraction">Bit Extraction</a></li><li><a class="toc-href" href="#bit concatenation" title="Bit Concatenation">Bit Concatenation</a></li><li><a class="toc-href" href="#bit inference" title="Bit Inference">Bit Inference</a></li></ul></li><li><a class="toc-href" href="#fu wei  reset_1" title="复位 reset">复位 reset</a></li><li><a class="toc-href" href="#uint class" title="UInt Class">UInt Class</a></li><li><a class="toc-href" href="#bool class" title="Bool Class">Bool Class</a></li><li><a class="toc-href" href="#casting between types" title="Casting Between Types">Casting Between Types</a></li><li><a class="toc-href" href="#moudule instantiation" title="Moudule Instantiation">Moudule Instantiation</a></li><li><a class="toc-href" href="#vec class" title="Vec Class">Vec Class</a></li><li><a class="toc-href" href="#parameterization" title="Parameterization">Parameterization</a></li><li><a class="toc-href" href="#built in primitives" title="Built In Primitives">Built In Primitives</a></li><li><a class="toc-href" href="#writing scala testbenches" title="Writing Scala Testbenches">Writing Scala Testbenches</a></li><li><a class="toc-href" href="#creating your own project" title="Creating Your Own Project">Creating Your Own Project</a></li><li><a class="toc-href" href="#memory" title="Memory">Memory</a></li><li><a class="toc-href" href="#def" title="def">def</a></li><li><a class="toc-href" href="#ref" title="Ref">Ref</a></li></ul></li></ul></div>
  </div>

  <div>
    <p><a href="https://qiangu.cool/riscv/learning_chisel_series_1_install.html">chisel 环境安装</a>成功之后，就可以正式开始 chisel 的学习之旅了。下面是我总结的 chisel 语法笔记。</p>
<h2 id="chisel tutorial &amp; chisel3">Chisel Tutorial &amp; Chisel3</h2>
<p><a href="https://github.com/ucb-bar/chisel-tutorial">Chisel Tutorial</a> 是官方提供的教程，阅读 wiki，走完整个流程，就能掌握一部分 chisel 的基本语法了。</p>
<p>Tutorial 下面的 <code>doc</code> 目录里面包含了一篇 chisel 入门论文，只要按照 Makefile 中的提示把所有的依赖包都安装好，就可以生成最终的 <a href="">pdf 论文</a>了。</p>
<p><a href="">Chisel3</a> 官方的 wiki 页面详细介绍了 chisel3 的语法。</p>
<hr/>
<h2 id="bian liang">变量</h2>
<h3 id="wire">wire</h3>
<p>用 <code>val</code> 声明一个变量，只要这个变量不是用 <code>Reg</code> 类型来赋值，那么它就会被解释成一个 verilog 中的 <code>wire</code>，因此这个变量也可以随意赋值给其他变量，就像 verilog 中的 <code>wire</code> 的行为一样。</p>
<p>verilog 中声明一个 <code>reg</code>，实际最终综合出来的可能是一条线 <code>wire</code>，也有可能是一个真正的寄存器 <code>register</code>，这是 verilog 语法的历史问题导致的。即使是很多老手，也经常声明错。</p>
<p>chisel 和 verilog 的不同之处在于，如果一个 <code>Reg</code> 变量，那么它一定会综合出一个上升沿触发的寄存器。chisel 中声明寄存器的方法有好几种，</p>
<ol>
<li>声明类型时不传递参数，在后面的语句中赋值（适合有条件赋值）</li>
<li>用 <code>RegNext()</code>声明的同时传参，那么在每个时钟上升沿都会采样该值（适合无条件打拍）</li>
</ol>
<div class="highlight"><pre><span></span><span class="c1">// method 1</span>
<span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">())</span>
<span class="n">when</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="n">x</span><span class="o">:=</span> <span class="n">y</span><span class="o">}</span>
  <span class="o">.</span><span class="n">elsewhen</span> <span class="o">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span><span class="n">x</span> <span class="o">:=</span> <span class="n">z</span><span class="o">}</span>
  <span class="o">.</span><span class="n">otherwise</span> <span class="o">{</span><span class="n">x</span> <span class="o">:=</span> <span class="n">w</span><span class="o">}</span>

<span class="c1">// method 2</span>
<span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="n">io</span><span class="o">.</span><span class="n">x</span>
<span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="nc">RegNext</span><span class="o">(</span><span class="n">y</span><span class="o">)</span>
</pre></div>
<p>需要注意的是，如果是用 <code>when</code> 语句有条件的赋值，那么要保证等号两边的数据类型和宽度相匹配，对于无条件赋值则无须这么做，因为编译器会根据右边的变量自动推断左边的寄存器类型和位宽。</p>
<h2 id="kong zhi yu ju_1">控制语句</h2>
<h3 id="for loop">for loop</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// exclusive n</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="c1">// include n</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="if-elseif-if">if-elseif-if</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(&lt;</span><span class="n">condition1</span><span class="o">&gt;)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(&lt;</span><span class="n">condition2</span><span class="o">&gt;)</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
</pre></div>
</td></tr></table>
<h3 id="when">when</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// when clause</span>
<span class="n">when</span> <span class="o">(&lt;</span><span class="n">condition1</span><span class="o">&gt;)</span> <span class="o">{...}</span>
<span class="o">.</span><span class="n">elsewhen</span> <span class="o">(&lt;</span><span class="n">condition2</span><span class="o">)</span> <span class="o">{...}</span>
<span class="o">.</span><span class="n">elsewhen</span> <span class="o">(&lt;</span><span class="n">condition3</span><span class="o">)</span> <span class="o">{...}</span>
<span class="o">.</span><span class="n">otherwise</span> <span class="o">{...}</span>

<span class="c1">// unless clause</span>
<span class="n">unless</span> <span class="o">(&lt;</span><span class="n">condition</span><span class="o">)</span> <span class="o">{...}</span>
</pre></div>
</td></tr></table>
<h3 id="assignments and re-assignments">Assignments and Re-assignments</h3>
<p>这是 chisel 的独特语法，在 chisel 中第一次定义变量时，必须使用 <code>=</code> 来告诉 chisel 生成这样一个硬件资源，之后如果想改变这个硬件的值，即重新赋值则必须使用 <code>:=</code>。</p>
<p>在电路中重新赋值的操作是没有意义的，因为一旦电路中任意两个节点之间只需要声明一次即可，之后 source 就会每时每刻都在驱动着 destination。那么就会有个问题，</p>
<p><code>Q：为什么 chisel 会出现重新赋值的语法？</code></p>
<p>原因是 chisel 和 verilog 的编译顺序不一样，它是顺序编译的。如果某个变量的赋值出现在定义的后面，就需要重新赋值。</p>
<p>一个最简单的例子就是 top 层的 I/O 信号，因为在端口上声明输出信号时我们并不知道它的值是多少，要在模块中计算更新才知道最终输出。</p>
<h3 id="bit extraction">Bit Extraction</h3>
<p>和 verilog 类似，提取 bit 位的语法不同而已，<code>[:]</code> 改成了 <code>(,)</code>。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">x_to_y</span> <span class="k">=</span> <span class="n">value</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span>
<span class="k">val</span> <span class="n">x_of_value</span> <span class="k">=</span> <span class="n">value</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="bit concatenation">Bit Concatenation</h3>
<p>和 verilog 的 bit 拼接不同，chisel 使用 <code>Cat()</code> 函数来实现 bit 拼接，和 bit 提取一样，高位部分是第一个参数，低位部分是第二个参数。<code>Cat()</code> 函数的实现在 chisel 的 util 包，不在 core 内，所以需要先 import 才能使用。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">chisel3.util.Cat</span>
<span class="c1">// or import all the utility definitions </span>
<span class="c1">// import chisel3.util._</span>

<span class="k">val</span> <span class="n">A</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)</span>
<span class="k">val</span> <span class="n">B</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)</span>
<span class="k">val</span> <span class="n">bus</span> <span class="k">=</span> <span class="nc">Cat</span><span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="n">B</span><span class="o">)</span>
</pre></div>
</td></tr></table>
<h3 id="bit inference">Bit Inference</h3>
<p>很多运算结果的位宽会比操作数更宽，比如加法和乘法，在传统的 verilog 编码中，硅农们必须手动指定每个 reg/wire 的位宽。相比之下，chisel 的一个强大功能是可以自动推断信号的位宽，所以它能节省广大硅农的很多时间，而且自动推断不会产生眼花手抖等情况，bug 率也大幅下降，妈妈再也不用担心我的代码位宽不匹配了 XD。</p>
<p>常见的 bit 位宽推断如下，</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Result Bit Width</th>
</tr>
</thead>
<tbody>
<tr>
<td>Z = X + Y</td>
<td>max(Width(X), Width(Y))</td>
</tr>
<tr>
<td>Z = X - Y</td>
<td>max(Width(X), Width(Y))</td>
</tr>
<tr>
<td>Z = X</td>
<td>Y</td>
</tr>
<tr>
<td>Z = X ^ Y</td>
<td>max(Width(X), Width(Y))</td>
</tr>
<tr>
<td>Z = ~X</td>
<td>Width(X)</td>
</tr>
<tr>
<td>Z = Mux(C, X, Y)</td>
<td>max(Width(X), Width(Y))</td>
</tr>
<tr>
<td>Z = X * Y</td>
<td>Width(X) + Width(Y)</td>
</tr>
<tr>
<td>Z = X &lt;&lt; n</td>
<td>Width(X) + n</td>
</tr>
<tr>
<td>Z = X &gt;&gt; n</td>
<td>Width(X) -n</td>
</tr>
<tr>
<td>Z = Cat(X, Y)</td>
<td>Width(X) + Width(Y)</td>
</tr>
<tr>
<td>Z = Fill(n, x)</td>
<td>Width(X) + n</td>
</tr>
</tbody>
</table>
<h2 id="fu wei  reset_1">复位 reset</h2>
<p>需要注意的是，前面的代码没有声明 clk 和 reset 信号，因为编译器会自动隐式地生成一个时钟信号和一个同步复位信号。</p>
<p>像 <code>val x = Reg(UInt())</code> 这种方式声明的寄存器是不带复位信号的，如果我们想指定复位的初始值，可以有两种方式，</p>
<ol>
<li>用 <code>RegInit()</code></li>
<li>在后续赋值中对寄存器进行初始化，chisel 自动隐式地生成的复位信号名字叫 <code>reset</code>，我们可以直接在代码中使用这个信号，但是为了把它转换成一个 Bool 类型的变量，需要显式地添加 <code>toBool</code> 来转换。</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// method 1: using RegInit()</span>
<span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="o">(</span><span class="mf">1.</span><span class="n">W</span><span class="o">))</span>

<span class="c1">// method 2: using reset.toBool</span>
<span class="n">when</span><span class="o">(</span><span class="n">reset</span><span class="o">.</span><span class="n">toBool</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span>
<span class="o">}</span> <span class="o">.</span><span class="n">elsewhen</span><span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="n">enable</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">:=</span> <span class="n">y</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>下面用一个 4bit 的 shift register 实例来说明，</p>
<p>版本一：使用 <code>RegInit()</code> 的代码，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">examples</span>

<span class="k">import</span> <span class="nn">chisel3._</span>

<span class="k">class</span> <span class="nc">ResetShiftRegister</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">in</span>    <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">shift</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="n">out</span>   <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="o">})</span>
  <span class="c1">// Register reset to zero</span>
  <span class="k">val</span> <span class="n">r0</span> <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">r1</span> <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">r2</span> <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">r3</span> <span class="k">=</span> <span class="nc">RegInit</span><span class="o">(</span><span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="n">when</span> <span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="n">shift</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">r0</span> <span class="o">:=</span> <span class="n">io</span><span class="o">.</span><span class="n">in</span>
    <span class="n">r1</span> <span class="o">:=</span> <span class="n">r0</span>
    <span class="n">r2</span> <span class="o">:=</span> <span class="n">r1</span>
    <span class="n">r3</span> <span class="o">:=</span> <span class="n">r2</span>
  <span class="o">}</span>
  <span class="n">io</span><span class="o">.</span><span class="n">out</span> <span class="o">:=</span> <span class="n">r3</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>版本二：使用 <code>reset.toBool</code> 的代码如下，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">examples</span>

<span class="k">import</span> <span class="nn">chisel3._</span>

<span class="k">class</span> <span class="nc">EnableShiftRegister</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">in</span>    <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">shift</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
    <span class="k">val</span> <span class="n">out</span>   <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
  <span class="o">})</span>
  <span class="k">val</span> <span class="n">r0</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">())</span>
  <span class="k">val</span> <span class="n">r1</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">())</span>
  <span class="k">val</span> <span class="n">r2</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">())</span>
  <span class="k">val</span> <span class="n">r3</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">())</span>
  <span class="n">when</span><span class="o">(</span><span class="n">reset</span><span class="o">.</span><span class="n">toBool</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">r0</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
    <span class="n">r1</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
    <span class="n">r2</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
    <span class="n">r3</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">)</span>
  <span class="o">}</span> <span class="o">.</span><span class="n">elsewhen</span><span class="o">(</span><span class="n">io</span><span class="o">.</span><span class="n">shift</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">r0</span> <span class="o">:=</span> <span class="n">io</span><span class="o">.</span><span class="n">in</span>
    <span class="n">r1</span> <span class="o">:=</span> <span class="n">r0</span>
    <span class="n">r2</span> <span class="o">:=</span> <span class="n">r1</span>
    <span class="n">r3</span> <span class="o">:=</span> <span class="n">r2</span>
  <span class="o">}</span>
  <span class="n">io</span><span class="o">.</span><span class="n">out</span> <span class="o">:=</span> <span class="n">r3</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>两个版本生成的 rtl 是一样的，核心部分如下，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="n">ResetShiftRegister</span><span class="p">(</span>
  <span class="k">input</span>        <span class="n">clock</span><span class="p">,</span>
  <span class="k">input</span>        <span class="n">reset</span><span class="p">,</span>
  <span class="k">input</span>  <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">io_in</span><span class="p">,</span>
  <span class="k">input</span>        <span class="n">io_shift</span><span class="p">,</span>
  <span class="k">output</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">io_out</span>
<span class="p">);</span>
  <span class="cm">/* some code */</span>
  <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clock</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span> <span class="k">begin</span>
      <span class="n">r0</span> <span class="o">&lt;=</span> <span class="mh">4'h0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">io_shift</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">r0</span> <span class="o">&lt;=</span> <span class="n">io_in</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span> <span class="k">begin</span>
      <span class="n">r1</span> <span class="o">&lt;=</span> <span class="mh">4'h0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">io_shift</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">r1</span> <span class="o">&lt;=</span> <span class="n">r0</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span> <span class="k">begin</span>
      <span class="n">r2</span> <span class="o">&lt;=</span> <span class="mh">4'h0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">io_shift</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">r2</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span> <span class="k">begin</span>
      <span class="n">r3</span> <span class="o">&lt;=</span> <span class="mh">4'h0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">io_shift</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">r3</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">endmodule</span>
</pre></div>
</td></tr></table>
<h2 id="uint class">UInt Class</h2>
<p>UInt（无符号整数类型）等价于 verilog 中的 unsigned 类型，UInt 运算的操作数类型必须也是 UInt 类型，支持的常见运算有，</p>
<table>
<thead>
<tr>
<th>Operand</th>
<th>Operation</th>
<th>Ooutput Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>Add</td>
<td>UInt</td>
</tr>
<tr>
<td>-</td>
<td>Subtract</td>
<td>UInt</td>
</tr>
<tr>
<td>*</td>
<td>Multiply</td>
<td>UInt</td>
</tr>
<tr>
<td>/</td>
<td>UInt Divide</td>
<td>UInt</td>
</tr>
<tr>
<td>%</td>
<td>Modulo</td>
<td>UInt</td>
</tr>
<tr>
<td>~</td>
<td>Bitwise Negation</td>
<td>UInt</td>
</tr>
<tr>
<td>^</td>
<td>Bitwise XOR</td>
<td>UInt</td>
</tr>
<tr>
<td>&amp;</td>
<td>Bitwise AND</td>
<td>UInt</td>
</tr>
<tr>
<td></td>
<td></td>
<td>Bitwise OR</td>
</tr>
<tr>
<td>===</td>
<td>Equal</td>
<td>Bool</td>
</tr>
<tr>
<td>=/=</td>
<td>Not Equal</td>
<td>Bool</td>
</tr>
<tr>
<td>&gt;</td>
<td>Greater</td>
<td>Bool</td>
</tr>
<tr>
<td>&lt;</td>
<td>Less</td>
<td>Bool</td>
</tr>
<tr>
<td>&gt;=</td>
<td>Greater or Equal</td>
<td>Bool</td>
</tr>
<tr>
<td>&lt;=</td>
<td>Less or Equal</td>
<td>Bool</td>
</tr>
</tbody>
</table>
<p>大部分运算符和 verilog 都是相同的，不同之处是 <code>|</code>、<code>===</code> 和 <code>=/=</code> 操作。</p>
<h2 id="bool class">Bool Class</h2>
<p>Bool 类用来表示逻辑表达式的结果，可以在 <code>when</code> 之类的条件语句中使用，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">change</span> <span class="k">=</span> <span class="n">io</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">b</span>
<span class="n">when</span> <span class="o">(</span><span class="n">change</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span> <span class="o">.</span><span class="n">otherwise</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">true_value</span>  <span class="k">=</span> <span class="kc">true</span><span class="o">.</span><span class="n">B</span>
<span class="k">val</span> <span class="n">false_value</span> <span class="k">=</span> <span class="n">flase</span><span class="o">.</span><span class="n">B</span>
</pre></div>
</td></tr></table>
<h2 id="casting between types">Casting Between Types</h2>
<p>chisel 要求赋值表达式的两边数据类型是一致的。如果直接把一个 Bool 类型的变量赋值给一个 UInt 类型会报错，正确做法是显式地进行转换，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span><span class="o">{</span>
    <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">2.</span><span class="n">W</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="nc">Ouptut</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">1.</span><span class="n">W</span><span class="o">))</span>
<span class="o">})</span>
<span class="n">io</span><span class="o">.</span><span class="n">out</span> <span class="o">:=</span> <span class="o">(</span><span class="n">in</span> <span class="o">===</span> <span class="mf">0.</span><span class="n">U</span><span class="o">).</span><span class="n">asUInt</span>
</pre></div>
</td></tr></table>
<p>常见的类型转换：</p>
<ul>
<li><code>asUInt()</code></li>
<li><code>asSInt()</code></li>
<li><code>asBool()</code></li>
</ul>
<h2 id="moudule instantiation">Moudule Instantiation</h2>
<p>chisel 中例化一个 module class 就等价于例化一个 verilog 的 module，具体方法就是 <code>Module</code> 调用 <code>new</code> 来创建一个新的 module，并把它赋值给一个 <code>val</code>，以便我们做端口连接。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Adder4</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
        <span class="k">val</span> <span class="n">A</span>    <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="n">B</span>    <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nc">Cin</span>  <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">1.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nc">Sum</span>  <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">4.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nc">Cout</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">1.</span><span class="n">W</span><span class="o">))</span>
        <span class="o">})</span>
    <span class="c1">// Adder for bit 0</span>
    <span class="k">val</span> <span class="nc">Adder0</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">FullAdder</span><span class="o">())</span>
    <span class="nc">Adder0</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">a</span> <span class="o">:=</span> <span class="n">io</span><span class="o">.</span><span class="n">A</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="nc">Adder0</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">a</span> <span class="o">:=</span> <span class="n">io</span><span class="o">.</span><span class="n">B</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="nc">Adder0</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">cin</span> <span class="o">:=</span> <span class="n">io</span><span class="o">.</span><span class="nc">Cin</span>
    <span class="k">val</span> <span class="n">s0</span> <span class="k">=</span> <span class="nc">Adder0</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">sum</span>
    <span class="c1">// other bits ...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<h2 id="vec class">Vec Class</h2>
<p><code>Vec</code> 类等价于 verilog 中的寄存器组，语法如下，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">myVec</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">of</span> <span class="n">elements</span><span class="o">&gt;</span> <span class="o">)</span> <span class="o">{</span> <span class="o">&lt;</span><span class="n">data</span> <span class="n">type</span><span class="o">})</span>
</pre></div>
</td></tr></table>
<p>有点类似 C++ 中的 vector，需要指明内部存放的数据类型，但是还需要额外指定 vector 的长度，举例如下，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">ufix_vec10</span> <span class="o">:=</span> <span class="nc">Vect</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">{</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">5.</span><span class="n">W</span><span class="o">)</span> <span class="o">})</span>
<span class="k">val</span> <span class="n">reg_vec32</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">Vec</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">32</span><span class="o">)</span> <span class="o">{</span> <span class="nc">UInt</span><span class="o">()</span> <span class="o">}))</span>
</pre></div>
</td></tr></table>
<p>给 vec 中的元素赋值或访问特定元素的方法，也和 verilog 类似，只不过是用 <code>()</code>，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">reg5</span> <span class="k">=</span> <span class="n">reg_vec</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="n">reg_vec32</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">:=</span> <span class="mf">0.</span><span class="n">U</span>
</pre></div>
</td></tr></table>
<p>还能用 vec 来例化一组 module，此时语法稍微有点不一样，因为 module 的数据类型和内置的 primitive 类型不一样，应该用 module 的 io Bundle，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="nc">FullAdders</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span> <span class="o">{</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">FullAdder</span><span class="o">()).</span><span class="n">io</span> <span class="o">})</span>
</pre></div>
</td></tr></table>
<h2 id="parameterization">Parameterization</h2>
<p>chisel 也可以实现 verilog 的参数化，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">FIFO</span>(<span class="n">width:</span> <span class="nb">Int</span>, <span class="n">depth:</span> <span class="nb">Int</span>) <span class="n">extends</span> <span class="nb">Module</span> {...}

<span class="n">val</span> <span class="n">fifo1</span> = <span class="nb">Module</span>(<span class="nb">new</span> <span class="n">FIFO</span>(<span class="mi">16</span>, <span class="mi">32</span>))
<span class="n">val</span> <span class="n">fifo2</span> = <span class="nb">Module</span>(<span class="nb">new</span> <span class="n">FIFO</span>(<span class="n">width</span> = <span class="mi">16</span>, <span class="n">depth</span> = <span class="mi">32</span>))
<span class="n">val</span> <span class="n">fifo3</span> = <span class="n">Moudle</span>(<span class="nb">new</span> <span class="n">FIFO</span>(<span class="n">depth</span> = <span class="mi">32</span>, <span class="n">width</span> = <span class="mi">16</span>))
</pre></div>
</td></tr></table>
<h2 id="built in primitives">Built In Primitives</h2>
<p>和 verilog 类似，chisel 中也定义了很多原语，这些原语和编译器绑定在一起，可以直接使用，比如 <code>Reg</code>, <code>UInt</code>, <code>Bundle</code>, <code>Mem</code> 和 <code>Vec</code> 等。</p>
<p><code>Mux</code> 原语，有三个输入，<code>select</code> 信号是 Bool 类型，<code>A</code> 和 <code>B</code> 可以是任意类型，任意宽度的信号，只要他们的类型一致即可。当 select 为 <code>true</code> 时输出 <code>A</code>，反之 select 是 <code>flase</code> 时输出 <code>B</code>。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="k">out</span> <span class="o">=</span> <span class="n">Mux</span><span class="p">(</span><span class="k">select</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<h2 id="writing scala testbenches">Writing Scala Testbenches</h2>
<p>模板：</p>
<ul>
<li>使用 <code>poke</code> 设置输入</li>
<li>使用 <code>step</code> 控制仿真的进度</li>
<li>使用 <code>expect</code> 或者是 <code>peek</code> 检查输出</li>
<li>不断重复直到所有的 test case 全部验证通过</li>
</ul>
<p>chisel 的 testbench 可以做简单的检查，跑基本的测试，但是对于比较大的设计，因为 chisel 本身的不完备，testbench 会变得非常复杂，速度也很很慢。所以官方建议用 C++ 的 emulator 或者是 verilog 的一套工具进行严谨的测试。</p>
<h2 id="creating your own project">Creating Your Own Project</h2>
<p>如果是自己创建项目，需要按照 sbt 的规则创建目录，很麻烦。推荐使用官方提供的模板 [chisel template][tempalte]，在其基础上修改是最省事的。</p>
<h2 id="memory">Memory</h2>
<p>只读 memory 可以用 <code>Vec</code> 实现，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">numbers</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="mf">0.</span><span class="n">U</span><span class="o">,</span> <span class="mf">1.</span><span class="n">U</span><span class="o">,</span> <span class="mf">2.</span><span class="n">U</span><span class="o">,</span> <span class="mf">3.</span><span class="n">U</span><span class="o">)</span>
</pre></div>
</td></tr></table>
<p>可读可写的 memory 用原语 <code>Mem</code>实现，</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// asynchronous read</span>
<span class="k">val</span> <span class="nc">CombMem</span> <span class="k">=</span> <span class="nc">Mem</span><span class="o">(&lt;</span><span class="n">size</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;)</span>

<span class="c1">// synchromous read</span>
<span class="k">val</span> <span class="nc">SeqMem</span> <span class="k">=</span> <span class="nc">SyncReadMem</span><span class="o">(&lt;</span><span class="n">size</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;)</span>

<span class="c1">// adding write ports</span>
<span class="n">when</span> <span class="o">(&lt;</span><span class="n">write</span> <span class="n">condiation</span><span class="o">&gt;)</span> <span class="o">{</span>
    <span class="o">&lt;</span><span class="n">memory</span> <span class="n">name</span><span class="o">&gt;(</span> <span class="o">&lt;</span><span class="n">write</span> <span class="n">address</span><span class="o">&gt;</span> <span class="o">)</span> <span class="o">:=</span> <span class="o">&lt;</span><span class="n">write</span> <span class="n">data</span><span class="o">&gt;</span>
<span class="o">}</span>

<span class="c1">// asynchronous read ports</span>
<span class="n">when</span> <span class="o">(&lt;</span><span class="n">read</span> <span class="n">condition</span><span class="o">&gt;)</span> <span class="o">{</span>
    <span class="o">&lt;</span><span class="n">read</span> <span class="n">data</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="o">&lt;</span><span class="n">memory</span> <span class="n">name</span><span class="o">&gt;(</span> <span class="o">&lt;</span><span class="n">read</span> <span class="n">address</span> <span class="mi">1</span><span class="o">&gt;)</span>
    <span class="o">...</span>
    <span class="o">&lt;</span><span class="n">read</span> <span class="n">data</span> <span class="n">N</span><span class="o">&gt;</span> <span class="o">:=</span> <span class="o">&lt;</span><span class="n">memory</span> <span class="n">name</span><span class="o">&gt;(</span> <span class="o">&lt;</span><span class="n">read</span> <span class="n">address</span> <span class="n">N</span><span class="o">&gt;)</span>
<span class="o">}</span>

<span class="c1">// synchromous read ports</span>
<span class="k">val</span> <span class="n">read_port</span> <span class="k">=</span> <span class="nc">Reg</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
<span class="n">when</span> <span class="o">(</span><span class="n">re</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">read_port</span> <span class="o">:=</span> <span class="n">myMem</span><span class="o">(</span><span class="n">raddr</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
<p>注意：chisel 中 <code>Mem</code> 不能指定初始化值。</p>
<h2 id="def">def</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
</pre></div>
</td></tr></table>
<h2 id="ref">Ref</h2>
<p><a href="https://github.com/ucb-bar/chisel-tutorial">Chisel Tutorial Wiki</a></p>
<p><a href="">Chilse3 Wiki</a></p>
  </div>

  <div class="tag-cloud">
    <p>
      <a href="../tag/chisel.html">chisel</a>
    </p>
  </div>


  <div class="neighbors">
  </div>


      <p>This post is part <built-in method index of unicode object at 0x7f221d4815a0> of the "" series:</p>
      <ol class="parts">
      </ol>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-responsive"
         data-ad-client="ca-pub-1821536199377100"
         data-ad-slot="4843941849"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'ChienGu';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy;  2020 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="ligtht"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Qian's Blog ",
  "url" : "..",
  "image": "/images/logo.png",
  "description": "Qian's Thoughts and Writings"
}
</script>
<a href="https://github.com/guqian110/guqian110.github.io" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <script>
      $(document).ready(function() {
        $('#tipue_search_input').tipuesearch();
      });
    </script>

</body>
</html>